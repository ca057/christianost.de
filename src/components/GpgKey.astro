---
import "../styles/variables.css";
import { gpgKey } from "../data/gpg-key";
import Code from "../components/Code.astro";
import Button from "../components/Button.astro";
import TextButton from "../components/TextButton.astro";

const buttonOpenId = "gpg-key_btn-open";
const buttonCloseId = "gpg-key_btn-close";
const buttonCopyId = "gpg-key_btn-copy";
const dialogId = "gpg-key_dlg";
---

<TextButton id={buttonOpenId}>
  <slot>GPG key</slot>
</TextButton>

<dialog id={dialogId} data-a11y-dialog={dialogId}>
  <div>
    <!-- TODO: make it icon buttons -->
    <Button id={buttonCopyId}>Copy</Button>
    <Button id={buttonCloseId}>Close</Button>
    <div id="key">
      <Code>{gpgKey}</Code>
    </div>
  </div>
</dialog>

<script
  defer
  src="https://cdn.jsdelivr.net/npm/a11y-dialog@7/dist/a11y-dialog.min.js"
></script>

<script
  define:vars={{
    buttonOpenId,
    buttonCloseId,
    buttonCopyId,
    dialogId,
  }}
>
  const dialog = document.getElementById(dialogId);

  const openButton = document.getElementById(buttonOpenId);
  openButton.addEventListener("click", () => {
    openButton.blur();
    dialog.showModal();
  });

  document.getElementById(buttonCloseId).addEventListener("click", () => {
    dialog.close();
  });

  document.getElementById(buttonCopyId).addEventListener("click", () => {
    // TODO: copy to clipboard
  });

  dialog.addEventListener("click", (event) => {
    if (event.target.nodeName === "DIALOG") {
      dialog.close();
    }
  });
</script>

<style>
  @media (prefers-reduced-motion: no-preference) {
    @keyframes slide-in-up {
      from {
        transform: scale(0.85) translateY(15%);
      }
    }

    dialog[open] {
      animation: slide-in-up 0.2s ease-out forwards;
    }
  }

  dialog {
    border: 4px solid var(--color-text);
    border-radius: 8px;
    padding: var(--spacing);
    background-color: var(--color-bg-1);
  }

  dialog > div {
    display: grid;
    grid-template-areas:
      "copy close"
      "key key";
    gap: 0 var(--spacing);
  }

  #key {
    grid-area: key;
  }
  #gpg-key_btn-close {
    grid-area: close;
  }
  #gpg-key_btn-copy {
    grid-area: copy;
  }
</style>
